{
  "name": "Snoopit",
  "tagline": "Simple tool for monitoring process log files for specified events  and then generating  a basic notification.",
  "body": "# Snoopit\r\n\r\n[![Gem Version][GV img]][Gem Version]\r\n[![Build Status][BS img]][Build Status]\r\n[![Dependency Status][DS img]][Dependency Status]\r\n[![Coverage Status][CS img]][Coverage Status]\r\n[![Code Climate](https://codeclimate.com/github/robdbirch/snoopit.png)](https://codeclimate.com/github/robdbirch/snoopit)\r\n\r\nSimple tool for monitoring process log files for specified events and then generating basic notifications. This is an extensible and data driven solution. It provides a single location to manage log scraping duties.\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n    gem 'snoopit'\r\n\r\nAnd then execute:\r\n\r\n    $ bundle\r\n\r\nOr install it yourself as:\r\n\r\n    $ gem install snoopit\r\n\r\n## Usage\r\nTypical use is via the command line with a JSON specification file.\r\n        \r\n    Usage: snoopit [options]\r\n        -s, --snoopers snoopies.json     File contains one or more regular expressions to locate a line of interest in a file\r\n        -S, --snooper snooper_name       Only use the named snooper. This option can be used more than once to use several snoopers.\r\n        -t, --template                   Generate a template snoopies.json file to stdout\r\n        -T, --tracking                   Enable log file tracking using file ./snoopit_db.json\r\n        -f, --tracking-file file_name    Specify a different tracking file name and location instead of the default ./snoopit_db.json\r\n        -j, --json                       Generate output in json\r\n        -J, --pretty-json                Generate output in pretty json\r\n        -N, --no-newline                 Do not output new line between found items\r\n        -n, --enable-notifications       Enable notifications\r\n        -l, --line-numbers               show line numbers\r\n        -v, --verbose                    prints out file name, matched line number\r\n        -h, --help\r\n\r\n### Basic Snoopers specification file\r\n\r\n`Snooper.json`\r\n\r\n        {\r\n          \"snoopers\" : {\r\n            \"AppServer1\" : {\r\n                  \"snoop\" : \"/opt/app_servers/app_server1/log/app.log\",\r\n                  \"sniffers\" : [\r\n                    {\r\n                      \"comment\" : \"Failed to communicate with remote sync server\",\r\n                      \"regexp\" : \"ERROR: Sync\",\r\n                      \"lines\" : {\r\n                        \"before\" : 1,\r\n                        \"after\" : 1\r\n                      }\r\n                    }\r\n                  ]\r\n              }\r\n           }\r\n        }\r\n\r\n        $ snoopit -s snoopers.json\r\n         ERROR: Max sync retry count reached\r\n         ERROR: Sync error on remote server syc_server_54\r\n         ERROR: Switching to alternate server sync_server_702\r\n\r\n## Snooper Configuration\r\nThis is a JSON file which describes to the `Snooper` how to snoop around files and directories to find items of interest using regular expressions. It contains an array of files to snoop. Each file can be associated one or more regular expressions. Each regular expression behavior can be customized and each regular expression can be associated with zero or more event notifiers. The `Snooper` file also specifies notifier configurations and how to load custom notifiers.\r\n\r\n        \"snoopers\" : {\r\n                       \"AppServer\": {\r\n                            \"snoop\": \"/opt/servers/app_server/log/my_app_server.log\"\r\n                            \"sniffers\" : [\r\n                                {\r\n                                    \"comment\" : \"Bad status from server\",\r\n                                    \"regexp\" : \"Non OK Status\",\r\n                                    \"lines\" : {\r\n                                        \"before\" : 2,\r\n                                        \"after\" : 2\r\n                                    },\r\n                                    \"notify\" : {\r\n                                            \"email\" : {\r\n                                                \"to\" : \"admin@myplace.com\"\r\n                                            },\r\n                                            \"http\" : {\r\n                                                \"url\" : \"http://localhost:3000/snoopers/snooped\"\r\n                                            }                                            \r\n                                    }\r\n                                }\r\n                             ]\r\n                        }\r\n        },\r\n        \"notifiers\" :\r\n          {\r\n              \"load\" : {\r\n                  \"MyNotifier\" : {\r\n                      \"file\" : \"/home/joe_code/snoopit/my_notifier\",\r\n                      \"class\" : \"MyNotifier\",\r\n                      \"config\" : { \"config_param\" : \"config_value\" }\r\n                  }\r\n              },\r\n              \"email\" : {\r\n                  \"smtp-server\" : \"smtp.gmail.com\",\r\n                  \"port\" : 587,\r\n                  \"tls\" : true,\r\n                  \"user\" : \"someone@gmail.com\",\r\n                  \"password\" : \"apassword\",\r\n                  \"authentication\" : \"login\"\r\n              }\r\n          }\r\n\r\n### Snoopers\r\nEach `Snooper` configured in the `JSON` file is associated with either a file or a directory that will be snooped.\r\n\r\n##### File Snoopers\r\nEach file `Snooper` can be associated with one file.\r\n\r\n        \"snoopers\": {\r\n            \"AppServer\":  {\r\n                \"snoop\": \"/opt/servers/app_server/log/my_app_server.log\"\r\n            }\r\n         }\r\n\r\n\r\nThe above specification will snoop the file `/opt/servers/app_server/log/my_app_server.log`\r\n\r\n##### Directory Snoopers\r\nEach directory `Snooper` can be associated with one directory. If the `glob` is not specified then every file in the directory is snooped. The `glob` string value is passed to Ruby's [`Dir.glob`](http://www.ruby-doc.org/core-2.1.1/Dir.html#method-c-glob)\r\n\r\n        \"snoopers\": {\r\n            \"AppServer\": {\r\n                  \"dir\" : {\r\n                      \"path\" : \"/opt/servers/app_server/log\",\r\n                      \"glob\" : \"*.log\"\r\n                    }\r\n             }\r\n        }\r\n\r\nThe above specification will snoop all files in directory `/opt/servers/app_server/log` with a suffix of `.log`\r\n\r\n#### Defining Snooper Regular Expressions\r\nEach `Snooper` has one or more regular expression specifications. This array of regular expressions are used to sniff through the files. These are identified as `Sniffers`.\r\n\r\n##### Sniffer Attributes\r\n\r\n* `comment`    Typically used by a `Notifier`, such as in the subject line in an email notifier.\r\n* `regexp`     The value of this string is passed to ruby's [Regexp](http://www.ruby-doc.org/core-2.1.1/Regexp.html)\r\n* `lines`\r\n    * `before` Number of lines to print out before the matched line\r\n    * `after`  Number of lines to print out after the matched line\r\n* `notify`     This is a list of event notifiers to use when a line is matched by the `regexp`\r\n\r\n        \"sniffers\" : [\r\n            {\r\n                \"comment\" : \"Bad status from server\",\r\n                \"regexp\" : \"Non OK Status\",\r\n                \"lines\" : {\r\n                    \"before\" : 2,\r\n                    \"after\" : 2\r\n                },\r\n                \"notify\" : {\r\n                        \"email\" : {\r\n                            \"to\": [ \"watcher@something.com\", \"admin@something.com\" ],\r\n                            \"from\" : \"snooper@something.com\"\r\n                        }\r\n                }\r\n            }\r\n         ]\r\n\r\n## Notifiers\r\nAfter a file has been snooped by a `Snooper` any items matched by a `Sniffer's` regular expression can be sent to a specified notifier. Notifier's can be used to send  notifications, such as an email, text messages, enqueue into a queueing system, or call a another service to take action based on the matched event.\r\n\r\n### Using a Notifier\r\nEach `Sniffer` can use one or more notifiers. Notification parameters are specified for each `Sniffer` that uses a particular notifier. In the example above the `email` notifier parameters used are the `to` and `from` parameters.\r\n\r\n### Configuring a Notifier for the Manager\r\nNotifiers will most likely need some minimal configuration information. These notifier configurations are specified after the `snoopers` section of the `Snooper` configuration file.\r\n\r\n       \"notifiers\" :\r\n            {\r\n                \"email\" : {\r\n                    \"smtp-server\" : \"smtp.gmail.com\",\r\n                    \"port\" : 587,\r\n                    \"user\" : \"someone@gmail.com\",\r\n                    \"password\" : \"password\",\r\n                    \"authentication\" : \"login\"\r\n                }\r\n            }\r\n\r\n\r\n\r\n### Email Notifier\r\nThe email notifier is a simple `SMTP` mail notification provider.\r\n\r\n#### Email Notifier Sniffer Parameters\r\nThe following parameters can be used with the `email` notifier\r\n\r\n* `to` Specifies who is to receive the email notification information. This can be a single string or an array\r\n\r\n        \"foo@bar.com\" or [ \"foo@bar.com\", \"bar@foo.com\" ]\r\n\r\n\r\n#### Email Notifier Configuration\r\nThe following configuration information is specified in the `notifiers` section of the `Snooper` configuration file.\r\n\r\n* `email` Section name\r\n* `smtp-server` SMTP sever name\r\n* `port` SMTP port\r\n* `user` User name\r\n* `password` Password\r\n* `authentication` Authentication type can be one of the following `plain`,`login`,`cram_md5`\r\n\r\n### Stomp Notifier\r\nThe stomp notifier is a simple `Stomp` notification provider.\r\n\r\n#### Stomp Notifier Sniffer Parameters\r\nThe following parameters can be used with the `stomp` notifier\r\n\r\nThe destination `queue` and `headers can be specified. \r\n\r\n    \"queue\" : \"/queue/snooped\",\r\n    \"headers\" : {\r\n        \"key-a\": \"a\",\r\n        \"key-b\": \"b\"\r\n    }\r\n\r\n\r\n#### Stomp Notifier Configuration\r\nThe following configuration information is specified in the `notifiers` section of the `Snooper` configuration file.\r\n\r\n    \"stomp\": {\r\n        \"host\": \"localhost\",\r\n        \"port\": \"61613\",\r\n        \"login\": \"admin\",\r\n        \"passcode\": \"flintstone\",\r\n        \"headers\": {\r\n            \"accept-version\": \"1.1\",\r\n            \"host\": \"vhost\"\r\n        }\r\n    }\r\n\r\n\r\n### Redis Notifier\r\nAvailable soon.\r\n\r\n### HTTP Post Notifier\r\nThe http notifier is a simple `HTTP` notification provider. It can handle post `http` and `https`.\r\nBasic authentication is available.\r\n\r\n#### HTTP Post Notifier Sniffer Parameters\r\nThe following parameters can be used with the `http` notifier\r\n\r\n* `url` Specifies where to post the notification information.\r\n\r\n          \"http\" : {\r\n             \"url\" : \"http://localhost:3000/snoopers/snooped\"\r\n          }\r\n      \r\n    or for `https`\r\n\r\n          \"https\" : {\r\n             \"url\" : \"https://localhost:3000/snoopers/snooped\"\r\n          }\r\n\r\n#### HTTP Post Notifier Configuration\r\nThe following configuration information is specified in the `notifiers` section of the `Snooper` configuration file.\r\n\r\n* `http` Section name. Use http **not** `https`\r\n* `api_key` The value of this parameter is placed in the header with the following format\r\n\r\n        Authorization: Token token=BR549\r\n             \r\n* `user` If a user parameter is passed then basic authentication will be performed with the given password\r\n* `password` If a password parameter is passed then basic authentication will be performed with the given user name\r\n\r\n\r\n        \"http\" : {\r\n            \"api-key\" : \"BR549\",\r\n            \"user\" : \"fred\",\r\n            \"password\" : \"flintstone\"\r\n        }\r\n\r\n\r\n### Building Custom Notifiers\r\nAll Notifiers must inherit from the class `Snoopit::Notifier` and implement the `notify` method\r\n\r\n      def notify(found, notify_params)\r\n        raise NotImplementedError.new 'Notifier#notify'\r\n      end\r\n\r\n#### `notify` Parameters\r\n\r\n* `found` is  a `hash` with the matched regular expression. It's what the `Snooper` sniffed out from the file.\r\n\r\n          {\r\n              comment: comment,\r\n              file: file,\r\n              before: [ lines before match ],\r\n              match: matched_line,\r\n              match_line_no: line_no_of_match,\r\n              after: [ lines after match ]\r\n          }\r\n\r\n* `notify_params` These are the parameters defined for the notifier in the `Sniffer notifier`  section (e.g. to and from parameters for the email notifier)\r\n\r\n        \"sniffers\" : [\r\n            {\r\n                \"comment\" : \"Bad status from server\",\r\n                \"regexp\" : \"Non OK Status\",\r\n                \"lines\" : {\r\n                    \"before\" : 2,\r\n                    \"after\" : 2\r\n                },\r\n                \"notify\" : {\r\n                        \"My Custom Notifier\" : {\r\n                            \"param1\": [ \"a_value1\", \"a_value2\" ],\r\n                            \"param2\" : \"value1\"\r\n                        }\r\n                }\r\n            }\r\n         ]\r\n\r\n### Dynamically Loading Custom Notifiers\r\nTo make a non default notifier available to the `Snooper` a notifier must be dynamically loaded. Specifying a `notifier` to be dynamically loaded is specified in the `notifiers` section of the `Snooper` configuration file.\r\n\r\n        \"notifiers\" {\r\n                        \"load\" : {\r\n                            \"My Custom Notifier\" : {\r\n                                \"file\" : \"/opt/snooper/notifiers/my_custom_notifier\",\r\n                                \"class\" : \"MyCustomNotifier\",\r\n                                \"config\" : { \"param1\": \"configure_me\" }\r\n                            }\r\n                        }\r\n                    }\r\n\r\nIn the `notifiers Hash` in the `load Hash` add the following in `Custom Notifier Hash`\r\n\r\n* A key with a descriptive unique name  `My Custom Notifier`\r\n* `file` The path to the ruby file that contains the custom notifier class `\"/opt/snooper/notifiers/my_custom_notifier\"`\r\n* `class` The class name of your notifier `MyCustomNotifier`\r\n* `config` Any parameters needed to configure the custom notifier prior to generating notifications\r\n\r\n\r\n### Custom Notifier Initialization\r\nInternally the `Snooper` will use an initializer with no arguments to create a custom notifier\r\n\r\n    MyCustomNotifier.new specified_config_params\r\n            \r\nIf there are `config` items specified then the `initializer` will pass those items to the `Custom Notifier#initializer`\r\n \r\n    def initializer(config)\r\n      super config\r\n      @my_param1 = config['param1']\r\n      @my_param2 = @config['param2'] \r\n      ...\r\n\r\n**Be sure** to call **`super config`** in your initializer. One of the functions of calling `super` is to place the `config` parameter into the instance variable `@config`\r\n\r\n### Specifying Custom Notifier Configuration Section Names\r\nThe key used for your notification parameters for both `configuring` and `notifying` is the class name:\r\n\r\n    MyCustomNotifier.class.name\r\n    \r\nThis can be changed in the `MyCustomNotifier#initializer` by passing a string to `super`\r\n\r\n    def initializer(config)\r\n      super config, 'my_custom_notifier_name'\r\n      @my_param1 = config['param1']\r\n      @my_param2 = @config['param2'] \r\n      ...\r\n\r\n## File Tracking\r\nTypically the `Snooper` is used for repeated invocations on a log file. This is typically done via `cron`. Enabling file tracking allows the `Snooper` to keep track of where it was in a file on it's last snoop of the file. Enabling file tracking prevents rereading the whole file and resending matched events. When file tracking is enabled using by the `-T` to `snoopit` the `Snooper` creates a `JSON` database in the directory where the `Snooper` was invoked. This file has the name `snoopit_db.json` The location of this file can be changed using the `-f` option of `snoopit`. If the `-f` option is used the `-T` is implied and does not need to be specified.\r\n\r\n\r\n## Cron example\r\n`\r\n*/15 * * * * /usr/local/bin/ruby /usr/local/ruby/gems/bin/snoopit -s /opt/admin/snoopit/cron_snoopit.json -f /opt/admin/snoopit/cron_snoopit_db.json -n >> /opt/admin/snoopit/cron_snoopit.out 2>&1\r\n`\r\n\r\n## History\r\nWritten this handy little utility too many times too count. From the ancient times via Rob Pikes and the gang's `sh`,`grep`, `awk`, `sed` and `mail` to Larry Wall's wonderful `perl` to the latest and best yet `ruby` from Matz.\r\n\r\n        grep -H -n -B 2 -A 2 'Look for this' ./log/some.log | awk ... |  mail ...\r\n        \r\n# Versioning\r\nThis library aims to adhere to [Semantic Versioning 2.0.0](http://semver.org/). Violations of this scheme should be reported as bugs. Specifically, if a minor or patch version is released that breaks backward compatibility, that version should be immediately yanked and/or a new version should be immediately released that restores compatibility. Breaking changes to the public API will only be introduced with new major versions. As a result of this policy, you can (and should) specify a dependency on this gem using the [Pessimistic Version Constraint](http://docs.rubygems.org/read/chapter/16#page74) with two digits of precision.\r\n        \r\n\r\n[Gem Version]: https://rubygems.org/gems/snoopit\r\n[Build Status]: https://travis-ci.org/robdbirch/snoopit\r\n[travis pull requests]: https://travis-ci.org/robdbirch/snoopit/pull_requests\r\n[Dependency Status]: https://gemnasium.com/robdbirch/snoopit\r\n[Coverage Status]: https://coveralls.io/r/robdbirch/snoopit\r\n\r\n[GV img]: https://badge.fury.io/rb/snoopit.png\r\n[BS img]: https://travis-ci.org/robdbirch/snoopit.png\r\n[DS img]: https://gemnasium.com/robdbirch/snoopit.png\r\n[CS img]: https://coveralls.io/repos/robdbirch/snoopit/badge.png?branch=master\r\n\r\n\r\n\r\n## Contributing\r\n\r\n1. Fork it\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Add some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}